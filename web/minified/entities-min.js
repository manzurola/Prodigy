var multiChoice=function(j,f){var l={NORMAL:"multichoice",MISTAKE:"multichoice mistake",MISTAKE_STATIC:"multichoice mistake-static",CORRECT:"multichoice correct",CORRECT_STATIC:"multichoice correct-static",HIDDEN:"multichoice hidden",BOWING:"bowing"};var g=entity(j,f),h=g.appendTo;var q={NORMAL:1,CORRECT:2,MISTAKE:3,HINT:4,HIDDEN:5,BOWING:6};var m={CORRECT:0,MISTAKE:1};var n=f.answer,o,s=document.createElement("span"),k=f.manager||{},d=q.NORMAL;(function r(){j.className=l.NORMAL;o=document.createElement("span");o.innerHTML=n.getToken();s.innerHTML="OK!";var u=document.createDocumentFragment();u.appendChild(o);u.appendChild(s);j.appendChild(u)})();g.toggleState=function(u){if(u===d){j.className=l.NORMAL}d=u;switch(d){case q.CORRECT:t();break;case q.MISTAKE:b();break;case q.HIDDEN:e();break}};g.setFeedbackOnCorrect=function(u){s.innerHTML=u;return this};g.getState=function(){return d};g.getManager=function(){return k};g.states=function(){return q};g.animations=function(){return m};g.getAnswer=function(){return n};g.putAnswer=function(){throw ERRORS.NOT_IMPLEMENTED};function b(){j.addEventListener("webkitAnimationEnd",a);j.className=l.MISTAKE}function a(){j.removeEventListener("webkitAnimationEnd",arguments.callee);g.fireEvent("mistakeAnimationEnd");j.className=l.MISTAKE_STATIC}function i(){j.className=l.NORMAL}function t(){j.addEventListener("webkitAnimationEnd",c);j.className=l.CORRECT}function c(){j.removeEventListener("webkitAnimationEnd",arguments.callee);g.fireEvent("correctAnimationEnd");j.className=l.CORRECT_STATIC}function e(){j.addEventListener("webkitAnimationEnd",p);j.className=l.HIDDEN}function p(){j.removeEventListener("webkitAnimationEnd",arguments.callee);g.fireEvent("hiddenAnimationEnd")}return g};var multiChoiceManager=function(g,j){var a={SELF:"multichoicer"};var e=entity(g,j),m=e.remove,i=e.appendTo;var b=[],f,d=100;(function l(){g.className=a.SELF;var q=j.answers;var n=j.answerTokens;for(var o=0;o<q.length;o++){var p={answer:q[o]};b.push(c(p))}}());e.getChoices=function(){return b};e.appendTo=function(n){i.apply(e,[n]);h();return this};e.remove=function(){m.apply(e,[]);k();return this};function h(){var n=1;for(var p=0;p<b.length;p++){var o=b[p];(function(r,q){f=setTimeout(function(){r.appendTo(e);if(q===b.length){clearTimeout(f)}},q*d)}(o,n));n++}}function k(){for(var o=0;o<b.length;o++){var n=b[o];n.remove()}}function c(o){var n=document.createElement("li");return multiChoice(n,o)}return e};var combo=function(b,d){var f={SELF:"combo"};var e=entity(b,d);var a=g(0),c=["ok!","good!","nice!","great!","grand!","awesome!","excellent!","splendid!","superb!","star!","amazing!","incredible!","spectacular!","prodigy!!"],h;(function(){b.className=f.SELF}());e.increment=function(){var i=a.getData()["value"]+1;a.remove();a=g(i).appendTo(e);return this};e.getCount=function(){return a.getData()["value"]};e.lose=function(){a.remove();a=g(0).appendTo(this);return this};e.getFeedback=function(){var i=a.getData()["value"];return i<c.length?c[i]:c[c.length-1]};function g(j){var i=document.createElement("span");return entity(i,{value:j}).setInnerText(j>1?j:"")}return e};var health=function(h,i){var b={SELF:"health",HURT:"hurt",LIVES_LEFT_3:"lives-left-3",LIVES_LEFT_2:"lives-left-2",LIVES_LEFT_1:"lives-left-1",LIVES_LEFT_0:"lives-left-0",HEART:"health-heart",HIT_POINTS:"health-strikes"};var g=entity(h);var a=i.hitpoints||10,f=0,c;(function j(){h.className=b.SELF;c=document.createElement("span");c.innerHTML=""+a;h.appendChild(c)}());g.increment=function(k){a+=k};g.getHitpoints=function(){return a};g.decrement=function(k){a-=k;f++;c.innerHTML=""+a;if(a<=0){g.fireEvent("hitpointsDepleted")}};g.getTimesHurt=function(){return f};g.hurt=function(){a-=1;f++;c.innerHTML=""+a;if(a<=0){g.fireEvent("hitpointsDepleted")}d();return this};function d(){h.addEventListener("webkitAnimationEnd",e);h.classList.add(b.HURT)}function e(){h.removeEventListener("webkitAnimationEnd",arguments.callee);h.classList.remove(b.HURT);g.fireEvent("hurtAnimationEnd")}return g};var starCounter=function(a,b){var g={SELF:"starCounter"};var f=entity(a,b);var h,e=b.total||0,d=0;(function(){a.className=g.SELF;h=c()}());f.increment=function(){d++;h.hide();h=c();return this};f.getCount=function(){return d};f.getTotal=function(){return e};function c(){var i=document.createElement("span");a.appendChild(i);return entity(i,{}).setInnerText(d)}return f};var score=function(f,i){var a={SELF:"score",MULTIPLIER:"score-multiplier",POINTS:"score-points"};var e=entity(f,i);var g=b(0),j=c(0);(function k(){f.className=a.SELF}());e.increment=function(l){var n;if(l>=250){n=10}else{n=5}var m=g.getData()["value"]+l;g.setData({value:m});d(l,n,m);return this};e.getMultiplierLevel=function(){return h()};e.getPoints=function(){return g.getData()["value"]};e.multiply=function(l){var m=j.getData()["value"];return m>0?l*m:l};e.incrementMultiplier=function(){var l=j.getData()["value"];l++;j.setData({value:l});if(l>1){j.remove();j=c(l)}return this};e.resetMultiplier=function(){j.setData({value:0}).hide();return this};function h(){return j.getData()["value"]}function c(m){var l=document.createElement("span");l.className=a.MULTIPLIER;f.appendChild(l);return entity(l,{value:m}).setInnerText(m>1?m:"")}function b(m){var l=document.createElement("span");l.className=a.POINTS;f.appendChild(l);return entity(l,{value:m}).setInnerText(m)}function d(l,n,m){if(l===0){return}if(l<n){n=l}g.setInnerText(m-l+n);setTimeout(function(){d(l-n,n,m)},10)}return e};var Clock=function(){var g=this;var e;var h;var i;var b;var c=null;var d=false;var k={milliseconds:0,seconds:0,minutes:0};(function(){e=document.getElementById("time");i=document.getElementById("seconds");b=document.getElementById("minutes")})();var a=function(){var l=1000;c=setInterval(function(){clearInterval(c);if(d){return}k.seconds++;if(k.seconds===60){k.minutes++;k.seconds=0}j();a()},l)};var f=function(){k.seconds=0;k.minutes=0;j()};var j=function(){i.innerText=k.seconds;b.innerText=k.minutes};this._start=function(){f();a();return g};this._pause=function(){d=true;return g};this._resume=function(){d=false;a();return g};this._getElapsedInMilliseconds=function(){return k.minutes*60*1000+k.seconds*1000+k.milliseconds}};var exercise=function(m,g){var n={SELF:"exercise",EXERCISE_TITLE:"exercise-title",SUBJECT_MATTER:"exercise-subjectMatter"};var h=entity(m,g);var u,e,s,a=g.instructions||"",t=[],c=0,p=0,f=false,q=false;(function i(){m.className=n.SELF;var v=g.questions;var y=null,A=null,x=null;for(var w=0;w<v.length;w++){var z={index:w,html:v[w]["html"],blanks:v[w]["blanks"],isFirst:!!(w===0),isLast:!!(w===v.length-1)};y=A;x=null;A=o(z);t.push(A);A.setPrevQuestion(y);A.setNextQuestion(x);if(y){y.setNextQuestion(A)}l(A)}u=j(g.title).appendTo(h);e=d(g.subjectName).appendTo(h);s=b().appendTo(h)}());h.getQuestions=function(){return t};h.isLastQuestion=function(){return q};h.setComplete=function(){f=true;h.fireEvent("complete")};h.getQuestionsCount=function(){return t.length};h.countBlanks=function(){return p};h.getAllBlanks=function(){var y=[];for(var w=0;w<t.length;w++){var x=t[w].getBlanks();for(var v=0;v<x.length;v++){y.push(x[v])}}return y};h.getAllAnswers=function(){var y=[];for(var x=0;x<t.length;x++){var w=t[x].getAllAnswers();for(var v=0;v<w.length;v++){y.push(w[v])}}return y};function l(w){var y=w.getBlanks();for(var x=0;x<y.length;x++){var A=y[x];var z=A.getAnswers();var v=r(z);A.setMultiChoiceManager(v);p++}}function k(v){c++;s.increment((1/t.length)*100);if(c===t.length){h.fireEvent("solved")}}function o(v){var w=document.createElement("div");return question(w,v).on("solved",k)}function r(x){var v=x.shuffle();var w=document.createElement("div");return multiChoiceManager(w,{answers:v})}function j(w){var v=document.createElement("div");v.innerHTML=typeof w==="string"?w:"";v.className=n.EXERCISE_TITLE;return entity(v,{})}function d(v){var w=document.createElement("div");w.className=n.SUBJECT_MATTER;w.innerHTML=typeof v==="string"?v:"";return entity(w,{})}function b(){var v=document.createElement("div");return progressBar(v,{value:0})}return h};var question=function(j,e){var k={SELF:"question",SOLVED:"solved",LAST:"last",FIRST:"first",BLANK:"blank",PREV:"prev-question-button",NEXT:"next-question-button"};var f=entity(j,e),l=f.remove;var q=[],r,i,m,d,n=false,g=e.isFirst,h=e.isLast;(function o(){j.className=k.SELF;j.innerHTML=e.html;if(g){j.classList.add(k.FIRST)}if(h){j.classList.add(k.LAST)}var w=j.getElementsByClassName(k.BLANK);for(var u=0;u<w.length;u++){var t={index:u,answers:e.blanks[u]["answers"],parentQuestion:f};var v=w[u];q.push(blank(v,t))}r=b().appendTo(f);i=c().appendTo(f)})();f.remove=function(){for(var t=0;t<q.length;t++){var u=q[t];if(u.isSolved()){u.removeInnerEntitiesAfterSolved()}}l.apply(this);return this};f.countBlanks=function(){return q.length};f.solved=function(t){if(t===true){n=true;p();f.fireEvent("solved")}else{n=false}return this};f.isSolved=function(){return n};f.findNextUnsolvedBlank=function(w){logIt("blank index offset: "+w);var v=null;var u=w+1;if(q[w]&&!q[w].isSolved()){return q[w]}for(var t=0;t<q.length;t++){if(u>=q.length){u=0}else{if(!q[u].isSolved()){v=q[u];break}else{u++}}}return v};f.countUnsolvedBlanks=function(){var u=0;for(var t=0;t<q.length;t++){if(!q[t].isSolved()){u++}}return u};f.getBlanks=function(){return q};f.getBlankAt=function(t){if(q[t]){return q[t]}else{return null}};f.getAllAnswers=function(){var v=[];for(var u=0;u<q.length;u++){var w=q[u].getAnswers();for(var t=0;t<w.length;t++){v.push(w[t])}}return v};f.getIndex=function(){return e.index};f.getPrevQuestion=function(){return m};f.setPrevQuestion=function(t){m=t;return this};f.getNextQuestion=function(){return d};f.setNextQuestion=function(t){d=t;return this};function p(){j.classList.add(k.SOLVED)}function b(){var t=document.createElement("div");t.className=k.PREV;return entity(t,{}).on("select",a)}function a(){f.fireEvent("prev")}function c(){var t=document.createElement("div");t.className=k.NEXT;return entity(t,{}).on("select",s)}function s(){f.fireEvent("next")}return f};var blank=function(i,e){var k={NORMAL:"blank",FOCUSED:"focused",CORRECT:"correct",MISTAKE:"mistake",HINT:"hint",STAR:"star",CHILD_ANSWER:"answer",CHILD_POINTS:"points"};var f=entity(i,e),l=f.remove;var p=false,u=false,r=false,t=e.parentQuestion,j=null,c=null,n=[],w=e.index,o=null,a=null;(function s(){i.className=k.NORMAL;f.on("select",function(){});c=d(100);j=v().appendTo(f);for(var y=0;y<e.answers.length;y++){var x={index:y,blankIndex:w,token:e.answers[y]["token"],isCorrect:e.answers[y]["correct"],feedback:e.answers[y]["feedback"],blank:this};n.push(b(x))}})();f.removeInnerEntitiesAfterSolved=function(){j.remove();c.remove();return this};f.submitAnswer=function(x){if(a){a.remove()}a=x.appendTo(this);if(a.isCorrect()){p=true;h()}else{p=false;m()}return p};f.getSubmittedAnswer=function(){return a};f.getStar=function(){return r?null:j};f.focus=function(){if(!u){i.classList.add(k.FOCUSED);u=true}return this};f.unFocus=function(){if(u){i.classList.remove(k.FOCUSED);u=false}return this};f.getMultiChoiceManager=function(){return o};f.setMultiChoiceManager=function(x){o=x};f.isSolved=function(){return p};f.getIndex=function(){return w};f.getAnswers=function(){return n};f.getPoints=function(){return c.getData()["value"]};f.setPoints=function(x){c.getData()["value"]=x;c.setInnerText(x);return this};function h(){q();if(r){j.hide()}else{}j.disableSelectEvents();i.classList.add(k.CORRECT);a.show();c.appendTo(f)}function m(){q();i.classList.add(k.MISTAKE);a.show();if(!r){j.disableSelectEvents();r=true}}function q(){i.className=k.NORMAL;if(u){i.classList.add(k.FOCUSED)}}function b(y){var x=document.createElement("span");x.className=k.CHILD_ANSWER;return answer(x,y).on("select",g)}function d(y){var x=document.createElement("span");x.className=k.CHILD_POINTS;return entity(x,{value:y}).setInnerText(y)}function v(){var x=document.createElement("span");x.className=k.STAR;return entity(x,{}).on("select",g)}function g(){f.fireEvent("select")}return f};var feedback=function(a,b){var e={SELF:"feedback"};var d=entity(a),g;(function f(){a.className=e.SELF}());d.put=function(h){c();g=document.createElement("span");g.innerHTML=h;a.appendChild(g)};d.clear=function(){c()};function c(){while(a.lastChild){a.removeChild(a.lastChild)}}return d};var answer=function(i,j){var d={SELF:"answer",HINT:"hint"};var f=entity(i,j),l=f.remove;var e=(typeof j.token==="string")?j.token:"",b=j.isCorrect,c,h=j.index,g=j.blankIndex;(function k(){i.className=d.SELF;i.innerHTML=e;c=a((typeof j.feedback==="string")?j.feedback:"")}());f.remove=function(){return l.apply(f)};f.getIndex=function(){return h};f.getHint=function(){return c};f.getToken=function(){return e};f.isCorrect=function(){return b};f.getBlankIndex=function(){return g};function a(n){var m=document.createElement("span");m.className=d.HINT;return hint(m,{text:n})}return f};var hint=function(f,h){var a={SELF:"hint",CHILD:"hint-elem"};var d=entity(f,h),j=d.remove,g=d.appendTo;var e;(function i(){f.className=a.SELF;e=k(h.text)}());d.remove=function(){while(f.lastChild){f.removeChild(f.lastChild)}return j.apply(this)};d.appendTo=function(m){g.apply(this,[m]);for(var l=0;l<e.length;l++){c(e[l],(l+1)*80)}};function b(l){var m=document.createElement("span");m.innerHTML=l;f.appendChild(m);return entity(m,{}).hide()}function k(l){var q=l.split("");var o=[];var p=0;while(p<q.length){var n=document.createElement("span");var m="";if(q[p]===" "){m="&nbsp";p++}m+=q[p];n.innerHTML=m;n.className=a.CHILD;o.push(n);p++}return o}function c(m,l){setTimeout(function(){f.appendChild(m)},l)}return d};var progressBar=function(a,b){var d={SELF:"progressBar",INNER:"progressBar-inner"};var c=entity(a);var h,e=(b.value<0)?0:b.value>100?100:b.value;(function f(){a.className=d.SELF;h=document.createElement("div");h.style.width=e+"%";h.className=d.INNER;a.appendChild(h)}());c.increment=function(i){e+=i;if(e>100){e=100}g()};c.decrement=function(i){e-=i;if(e<0){e=0}g()};c.getValue=function(){return e};function g(){h.style.width=e+"%"}return c};var list=function(a,d){var f={SELF:"list",ITEM:"list-item"};var e=entity(a);var c=d.items,b=[];(function h(){a.className=f.SELF;for(var j=0;j<c.length;j++){var k=document.createElement("li");k.className=f.ITEM;k.innerHTML=c[j];k.addEventListener("click",g)}}());e.setText=function(i){text=i;a.innerHTML=text;return this};function g(i){}return e};var segmenter=function(h,j){var a={SELF:"segmenter",SEGMENT:"segmenter-segment"};var f=entity(h,j),l=f.remove,i=f.appendTo;var g=[],d=j.text||"",c=j.delimiter||"";(function k(){h.className=a.SELF;g=m(j.text)}());f.remove=function(){while(h.lastChild){h.removeChild(h.lastChild)}return l.apply(this)};f.appendTo=function(o){i.apply(this,[o]);for(var n=0;n<g.length;n++){e(g[n],(n+1)*80)}};function b(n){var o=document.createElement("span");o.innerHTML=n;h.appendChild(o);return entity(o,{}).hide()}function m(n){var s=n.split(c);var p=[];var q=0;while(q<s.length){var o="";if(s[q]===" "){o="&nbsp";q++}o+=s[q];var r=document.createElement("span");r.innerHTML=o;r.className=a.CHILD;p.push(r);q++}return p}function e(o,n){setTimeout(function(){h.appendChild(o)},n)}return f};