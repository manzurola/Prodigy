var game=function(g){var u={PAUSE_BUTTON:"pause-button"};var L=entity(g);var T={BY_BLANK:0,BY_QUESTION:1,BY_EXERCISE:2};var h,A=T.BY_QUESTION,G=null,n=null,M=600,O=null,N=null,X=null,c=null,z=null,q,Q,K,E,v=false,J,V={score:0,accuracyBonus:0,timeBonus:0,totalScore:0};L.initExercise=function(Y){U(Y);return this};L.getGameStats=function(){return V};L.getStarsCollected=function(){return N.getCount()};L.getTotalStarsToCollect=function(){return N.getTotal()};L.getGrade=function(){var Y=N.getTotal();var Z=N.getCount();return parseInt((Z/Y)*100)};L.getScore=function(){return h.getPoints()};L.start=function(){B();return this};L.pause=function(){e();return this};L.resume=function(){w();return this};L.restart=function(){r();return this};L.quit=function(){x();return this};function U(Y){J=Y;x();z=y();o();Q=z.countBlanks();q=0;K=null;E=null;c=a();O=D();N=k();G=m(10);h=s();I();X=new Clock();return L}function W(Y){logIt("playing intro...");setTimeout(function(){logIt("intro played");Y()},0)}function l(aa){logIt("handling blank select event. TARGET:");logIt(aa);if(aa===E){return}if(n){clearTimeout(n);n=null}if(E){E.unFocus().getMultiChoiceManager().remove();var Y=E.getSubmittedAnswer();if(Y){Y.getHint().remove()}}E=aa;var Z=E.getSubmittedAnswer();if(Z){Z.getHint().appendTo(z)}E.focus().getMultiChoiceManager().appendTo(z)}function F(Z){if(!E.isSolved()){var Y=Z.getAnswer().isCorrect();if(Y){C(Z)}else{S(Z)}}}function C(ab){if(E.getStar()!==null){O.increment();N.increment()}var aa=E.getPoints();aa=h.multiply(aa);E.setPoints(aa);h.increment(aa);Q--;q--;var Z=E.getSubmittedAnswer();if(Z){logIt("previous answer: "+Z.getToken());Z.getHint().remove()}var Y=ab.getAnswer();Y.getHint().appendTo(z);ab.setFeedbackOnCorrect(O.getFeedback()).toggleState(ab.states().CORRECT);E.submitAnswer(ab.getAnswer());if(q<=0){j();logIt("question solved in submit correct choice")}else{n=setTimeout(P,M)}}function S(ab){O.lose();h.resetMultiplier();G.hurt();var Y=parseInt(E.getPoints()/2);E.setPoints(Y);var aa=E.getSubmittedAnswer();if(aa){logIt("previous answer: "+aa.getToken());aa.getHint().remove()}var Z=ab.getAnswer();Z.getHint().appendTo(z);ab.toggleState(ab.states().MISTAKE);E.submitAnswer(Z);if(G.getHitpoints()<=0){R()}}function p(Y){if(Y.hasBeenRevealed()){Y.disable()}else{if(Y.isEnabled()){Y.reveal()}}logIt("handling hint select event. Target:");logIt(Y)}function P(){var Y=K.findNextUnsolvedBlank(E.getIndex());if(Y===null){Y=K.getBlanks()[0]}l(Y)}function f(Y){logIt("question select event");if(Y!==K){if(K){K.remove()}K=Y.appendTo(z);if(!Y.isSolved()){q=K.countUnsolvedBlanks()}l(K.getBlanks()[0])}}function b(Y){var Z=Y.getPrevQuestion();if(Z){f(Z)}}function i(Z){if(Z.isSolved()){var Y=Z.getNextQuestion();if(Y){f(Y)}else{H()}}}function j(){K.solved(true);if(O.getCount()>=K.countBlanks()){h.incrementMultiplier()}}function R(){logIt("!!! - exercise failed");X._pause();L.fireEvent("exerciseFailed")}function H(){logIt("!!! - exercise cleared");d();L.fireEvent("exerciseCleared")}function B(){z.getQuestions()[0].fireEvent("select")}function e(){v=true;L.fireEvent("pause")}function w(){v=false}function r(){U(J);B()}function t(){x();L.fireEvent("quit")}function x(){while(g.lastChild){g.removeChild(g.lastChild)}}function d(){V.score=h.getPoints();V.accuracyBonus=G.getHitpoints()*100;V.totalScore=V.score+V.accuracyBonus;return V}function o(){z.getQuestions().map(function(Y){Y.on("select",f,Y).on("prev",b,Y).on("next",i,Y).getBlanks().map(function(Z){Z.on("select",l,Z).getMultiChoiceManager().getChoices().map(function(aa){aa.on("select",F,aa)})})})}function y(){var Y=document.createElement("div");g.appendChild(Y);return exercise(Y,J)}function a(){var Y=document.createElement("div");g.appendChild(Y);return feedback(Y,{})}function D(){var Y=document.createElement("div");return combo(Y,{})}function m(aa){var Y=document.createElement("div");var Z=health(Y,{hitpoints:aa});g.appendChild(Y);return Z}function k(){var Z=document.createElement("div");var Y=starCounter(Z,{total:z.countBlanks()});g.appendChild(Z);return Y}function s(){var Y=document.createElement("div");g.appendChild(Y);return score(Y,{})}function I(){var Y=document.createElement("div");Y.className=u.PAUSE_BUTTON;Y.addEventListener("click",function(){e()});g.appendChild(Y);return Y}return L};var COMBO_CHAIN=(function(){var k=3000;var i=[];var n=false;var d;var g;var f;var o;var h=function(q,p){n=true;d=+new Date();f=setTimeout(function(){n=false;g=+new Date();q()},p)};var a=function(r){r.dataset.chained=true;i.push(r);if(n){var p=b();clearTimeout(f);var q=(100/i.length)+(k-p);h(o,q)}};var c=function(){h(o,k)};var l=function(){clearTimeout(f);n=false};var e=function(){};var m=function(){i.length=0;o=null};var j=function(){l();o()};var b=function(){return +new Date()-d};return{start:function(p){o=p;c();return this},chain:function(p){a(p);return this},clearData:function(){m();return this},freeze:function(){},forceStop:function(){j();return this},getBlanks:function(){return i},isRunning:function(){return n}}})();var SOUND_MANAGER=(function(){var a={};return{SOUNDS:a,play:function(c,b){switch(c){}}}})();